<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KB MED - Modula L</title>
    <!-- CSS Styles -->
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/components/header.css" />
    <link rel="stylesheet" href="css/components/footer.css" />
    <link rel="stylesheet" href="css/components/navigation.css" />
    <link rel="stylesheet" href="css/components/dropdown.css" />
    <link rel="stylesheet" href="css/components/buttons.css" />
    <link rel="stylesheet" href="css/components/colors.css" />
    <link rel="stylesheet" href="css/components/forms.css" />
    <link rel="stylesheet" href="css/components/modals.css" />
    <link rel="stylesheet" href="css/pages/machine-page.css" />
    <link
      rel="shortcut icon"
      href="assets/icons/favicon.webp"
      type="image/x-icon"
    />
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
      /* ===============================
         Styles g√©n√©raux pour les modals
      =============================== */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
        width: 100%;
        height: 100%;
        padding: 20px;
        background-color: rgba(0, 0, 0, 0.5);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        overflow-y: auto;
      }
      .modal.active {
        opacity: 1;
        visibility: visible;
      }
      .modal-content {
        background: #fff;
        max-width: 600px;
        margin: 60px auto;
        padding: 30px;
        border-radius: 8px;
        position: relative;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        animation: slideDown 0.3s ease;
      }
      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10%);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .modal-close {
        position: absolute;
        top: 12px;
        right: 12px;
        background: none;
        border: none;
        font-size: 28px;
        color: #333;
        cursor: pointer;
        transition: color 0.2s ease;
      }
      .modal-close:hover {
        color: #000;
      }
      /* ===============================
         Styles pour la liste d'options
      =============================== */
      .options-list {
        overflow-y: auto;
        border: 1px solid #ccc;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 20px;
        background-color: #fefefe;
      }
      .checkbox-container {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
        padding: 5px 0;
        transition: background-color 0.2s ease;
      }
      .checkbox-container:hover {
        background-color: #fafafa;
      }
      .checkbox {
        flex: 0 0 24px;
        width: 24px;
        height: 24px;
        border: 2px solid #333;
        border-radius: 4px;
        margin-right: 12px;
      }
      .label {
        flex: 1;
        font-size: 1rem;
        color: #333;
      }
      /* ===============================
         Styles pour les boutons et formulaires
      =============================== */
      .button {
        background-color: #005a9c;
        color: #fff;
        padding: 12px 24px;
        font-size: 1rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        display: inline-block;
        text-align: center;
      }
      .button:hover {
        background-color: #004a85;
        transform: translateY(-2px);
      }
      .form-group {
        margin-bottom: 16px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
      }
      .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }
      .form-group input:focus {
        border-color: #005a9c;
        outline: none;
      }
      .error-message {
        color: #d8000c;
        font-size: 0.875rem;
        margin-top: 4px;
      }
      /* ===============================
         Spinner de chargement (facultatif)
      =============================== */
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 6px solid #f3f3f3;
        border-top: 6px solid #005a9c;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      /* ===============================
         Styles sp√©cifiques du popup r√©capitulatif
      =============================== */
      #summaryModal p {
        margin-bottom: 16px;
        font-size: 1.1rem;
        line-height: 1.6;
        color: #333;
      }
      /* Le carr√© qui affichera la couleur sur le popup r√©capitulatif */
      .color-sample {
        display: inline-block;
        vertical-align: middle;
        width: 20px;
        height: 20px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-right: 8px;
      }
      /* ===============================
         Styles pour les s√©lecteurs de langue
      =============================== */
      .settings-item {
        display: flex;
        gap: 12px;
      }
      .language-selector {
        cursor: pointer;
        filter: grayscale(1);
        transition: filter 0.3s ease, transform 0.2s ease;
      }
      .language-selector.active,
      .language-selector:hover {
        filter: grayscale(0);
        transform: scale(1.05);
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="main-header">
      <button class="settings-btn" id="settingsBtn" aria-label="Param√®tres">
        <img src="assets/icons/settings.svg" alt="Param√®tres" />
      </button>
      <div class="logo">
        <img class="logo-img" src="assets/logos/kbmed.svg" alt="KB MED" />
      </div>
      <button class="burger-btn" id="burgerBtn" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </header>

    <!-- Menu de navigation -->
    <nav class="main-nav" id="mainNav">
      <button class="nav-close" id="navClose">&times;</button>
      <a
        href="index.html"
        class="nav-item active"
        data-translate="navigation.machine1"
        >MODULA L</a
      >
      <a
        href="modula-m.html"
        class="nav-item"
        data-translate="navigation.machine2"
        >MODULA M</a
      >
      <a
        href="catalogue.html"
        class="nav-item"
        data-translate="navigation.catalogue"
        >CATALOGUE</a
      >
      <div class="nav-background"></div>
    </nav>

    <!-- Menu des param√®tres -->
    <div class="settings-menu" id="settingsMenu">
      <div class="settings-item">
        <div class="language-selector active">
          <img src="assets/icons/flag-fr.svg" alt="Fran√ßais" data-lang="fr" />
        </div>
        <div class="language-selector">
          <img src="assets/icons/flag-de.svg" alt="Allemand" data-lang="de" />
        </div>
        <div class="language-selector">
          <img src="assets/icons/flag-it.svg" alt="Italie" data-lang="it" />
        </div>
      </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Contenu principal -->
    <main>
      <h1 class="machine-title" data-translate="navigation.machine1">
        MODULA L
      </h1>
      <div class="machine-image-container">
        <img
          id="machineImage"
          src="assets/img/machines/modula-l/RAL9016.jpg"
          alt="Machine Modula L"
        />
      </div>
      <!-- Accord√©ons -->
      <div class="accordion-container">
        <!-- Accord√©on Couleur -->
        <div class="accordion-item">
          <button class="accordion-header" data-translate="accordion.colors">
            Changer la couleur <span class="arrow" style="float: right">‚ñº</span>
          </button>
          <div class="accordion-content">
            <div class="color-grid">
              <div class="color-ral1001 color-option"></div>
              <div class="color-ral1013 color-option"></div>
              <div class="color-ral1028 color-option"></div>
              <div class="color-ral3004 color-option"></div>
              <div class="color-ral3020 color-option"></div>
              <div class="color-ral5003 color-option"></div>
              <div class="color-ral5010 color-option"></div>
              <div class="color-ral5014 color-option"></div>
              <div class="color-ral5017 color-option"></div>
              <div class="color-ral5018 color-option"></div>
              <div class="color-ral5024 color-option"></div>
              <div class="color-ral6029 color-option"></div>
              <div class="color-ral6034 color-option"></div>
              <div class="color-ral7011 color-option"></div>
              <div class="color-ral7016 color-option"></div>
              <div class="color-ral7032 color-option"></div>
              <div class="color-ral7035 color-option"></div>
              <div class="color-ral7044 color-option"></div>
              <div class="color-ral7045 color-option"></div>
              <div class="color-ral9010 color-option"></div>
              <div class="color-ral9016 color-option active"></div>
            </div>
          </div>
        </div>
        <!-- Accord√©on D√©tails techniques -->
        <div class="accordion-item">
          <button class="accordion-header" data-translate="accordion.details">
            D√©tails techniques <span class="arrow" style="float: right">‚ñº</span>
          </button>
          <div class="accordion-content">
            <ul class="tech-details">
              <li data-translate="technical.dimensions">
                Dimensions: 120 x 80 x 60 cm
              </li>
              <li data-translate="technical.weight">Poids: 85 kg</li>
              <li data-translate="technical.power">Puissance: 2000W</li>
            </ul>
          </div>
        </div>
        <!-- Accord√©on Options -->
        <div class="accordion-item">
          <button class="accordion-header" data-translate="accordion.customize">
            Personnaliser ma machine
            <span class="arrow" style="float: right">‚ñº</span>
          </button>
          <div class="accordion-content">
            <!-- Le formulaire dans l'accord√©on, contenant le bouton pour ouvrir le popup Options -->
            <form id="optionsForm">
              <button
                type="button"
                class="save-config-btn button"
                id="openOptionsBtn"
                data-translate="options.saveConfig"
              >
                Aller au configurateur
              </button>
            </form>
          </div>
        </div>
      </div>
      <button
        class="cta-button button"
        onclick="window.location.href='catalogue.html'"
        data-translate="general.seeMore"
      >
        Voir le catalogue
      </button>
    </main>

    <!-- ======================================
         Popup Modal Options (initialement masqu√©)
    ====================================== -->
    <div class="modal" id="optionsModal">
      <div class="modal-content">
        <button class="modal-close" id="closeOptions">&times;</button>
        <h2>Personnalisez vos options</h2>
        <div class="options-list" id="optionsList">
          <!-- 45 options g√©n√©r√©es -->
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option1"
              value="√âclairage d'instruments LED RGB, avec changement de couleurs RGB (rouge, vert, bleu) incl. t√©l√©commande"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option1">
              √âclairage d'instruments LED RGB, avec changement de couleurs RGB
              (rouge, vert, bleu) incl. t√©l√©commande
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option2"
              value="Plateau d'instruments chauffant, pour le plan des instruments"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option2">
              Plateau d'instruments chauffant, pour le plan des instruments
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option3"
              value="Tiroir UV, pour le rangement des instruments trait√©s"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option3">
              Tiroir UV, pour le rangement des instruments trait√©s
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option4"
              value="Double galerie, au-dessus du plan des instruments avec plaque en aluminium puls√©e"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option4">
              Double galerie, au-dessus du plan des instruments avec plaque en
              aluminium puls√©e
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option5"
              value="Galerie, au-dessus du plan des instruments avec plaque en aluminium puls√©e"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option5">
              Galerie, au-dessus du plan des instruments avec plaque en
              aluminium puls√©e
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option6"
              value="Multiprise pour l'option galerie"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option6">
              Multiprise pour l'option galerie
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option7"
              value="Extension de plateau L, plateau de 1152 mm en mat√©riau min√©ral r√©sistant HI-MACS¬Æ"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option7">
              Extension de plateau L, plateau de 1152 mm en mat√©riau min√©ral
              r√©sistant HI-MACS¬Æ
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option8"
              value="Extension de plateau M, plateau de 985 mm en mat√©riau min√©ral r√©sistant HI-MACS¬Æ"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option8">
              Extension de plateau M, plateau de 985 mm en mat√©riau min√©ral
              r√©sistant HI-MACS¬Æ
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option9"
              value="Extension de plateau S, plateau de 500 mm en mat√©riau min√©ral r√©sistant HI-MACS¬Æ"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option9">
              Extension de plateau S, plateau de 500 mm en mat√©riau min√©ral
              r√©sistant HI-MACS¬Æ
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option10"
              value="Support de lampe frontale avec aimant, non commut√©"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option10">
              Support de lampe frontale avec aimant, non commut√©
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option11"
              value="Suspension pour lampe frontale √† lumi√®re froide, commutation automatique, r√©glable en hauteur et pivotante"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option11">
              Suspension pour lampe frontale √† lumi√®re froide, commutation
              automatique, r√©glable en hauteur et pivotante
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option12"
              value="Support de microscope pour microscopes Kaps SOM-22, c√¥t√© gauche"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option12">
              Support de microscope pour microscopes Kaps SOM-22, c√¥t√© gauche
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option13"
              value="Support de microscope pour microscopes Kaps SOM-22, c√¥t√© droit"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option13">
              Support de microscope pour microscopes Kaps SOM-22, c√¥t√© droit
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option14"
              value="Bras pivotant pour √©cran TFT, montage sur l'unit√© ORL"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option14">
              Bras pivotant pour √©cran TFT, montage sur l'unit√© ORL
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option15"
              value="Bras pivotant pour √©cran TFT, montage sur la perche du microscope"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option15">
              Bras pivotant pour √©cran TFT, montage sur la perche du microscope
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option16"
              value="Bras pivotant avec plateau, dimensions 360 x 280 mm, montage sur l'unit√© ORL, environ 360 x 280 mm (L x P), max 10 kg"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option16">
              Bras pivotant avec plateau, dimensions 360 x 280 mm, montage sur
              l'unit√© ORL, environ 360 x 280 mm (L x P), max 10 kg
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option17"
              value="Syst√®me d'aspiration avec vidange manuelle du bac √† s√©cr√©tions, pompe √† vide sans huile (40 l/min √† -0,85 bar), suspension sans vibrations, commutation automatique lors du retrait du tuyau d'aspiration, filtre √† bact√©ries, bac √† s√©cr√©tions de 2,0 L (connectable directement), tuyaux antibact√©riens avec raccords rapides (aucune connexion d'eau requise)"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option17">
              Syst√®me d'aspiration avec vidange manuelle du bac √† s√©cr√©tions,
              pompe √† vide sans huile (40 l/min √† -0,85 bar), suspension sans
              vibrations, commutation automatique lors du retrait du tuyau
              d'aspiration, filtre √† bact√©ries, bac √† s√©cr√©tions de 2,0 L
              (connectable directement), tuyaux antibact√©riens avec raccords
              rapides (aucune connexion d'eau requise)
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option18"
              value="Syst√®me d'aspiration 'Sekretomatik', vidange automatique du bac √† s√©cr√©tions avec rin√ßage, commutation automatique lors du retrait du tuyau d'aspiration, pompe √† vide sans huile (40 l/min √† -0,85 bar), suspension sans vibrations, filtre √† bact√©ries, pompe de relevage, valve AquaStop, tuyaux de raccordement, tuyaux antibact√©riens avec raccords rapides (connexion d'eau requise)"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option18">
              Syst√®me d'aspiration 'Sekretomatik', vidange automatique du bac √†
              s√©cr√©tions avec rin√ßage, commutation automatique lors du retrait
              du tuyau d'aspiration, pompe √† vide sans huile (40 l/min √† -0,85
              bar), suspension sans vibrations, filtre √† bact√©ries, pompe de
              relevage, valve AquaStop, tuyaux de raccordement, tuyaux
              antibact√©riens avec raccords rapides (connexion d'eau requise)
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option19"
              value="Aspiration avec vidange manuelle du bac √† s√©cr√©tions, syst√®me d'aspiration monodirectionnel MEDELA (aucune connexion d'eau requise)"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option19">
              Aspiration avec vidange manuelle du bac √† s√©cr√©tions, syst√®me
              d'aspiration monodirectionnel MEDELA (aucune connexion d'eau
              requise)
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option20"
              value="Aspiration avec vidange manuelle du bac √† s√©cr√©tions, syst√®me d'aspiration monodirectionnel SERRES (aucune connexion d'eau requise)"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option20">
              Aspiration avec vidange manuelle du bac √† s√©cr√©tions, syst√®me
              d'aspiration monodirectionnel SERRES (aucune connexion d'eau
              requise)
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option21"
              value="Sac interne monodose MEDELA avec agent g√©lifiant, 1,5 L (30 pi√®ces)"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option21">
              Sac interne monodose MEDELA avec agent g√©lifiant, 1,5 L (30
              pi√®ces)
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option22"
              value="Sac interne monodose SERRES avec agent g√©lifiant, 1,5 L (32 pi√®ces)"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option22">
              Sac interne monodose SERRES avec agent g√©lifiant, 1,5 L (32
              pi√®ces)
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option23"
              value="R√©gulateur de vide pour dosage pr√©cis, plage de r√©glage : 0 √† 0,85 bar"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option23">
              R√©gulateur de vide pour dosage pr√©cis, plage de r√©glage : 0 √† 0,85
              bar
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option24"
              value="Tuyau d'aspiration s√©par√© pour l'adaptation du bac √† salive/tasse √† rin√ßage auriculaire avec commutation automatique lors du retrait du tuyau d'aspiration"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option24">
              Tuyau d'aspiration s√©par√© pour l'adaptation du bac √† salive/tasse
              √† rin√ßage auriculaire avec commutation automatique lors du retrait
              du tuyau d'aspiration
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option25"
              value="Syst√®me de rin√ßage du tuyau avec nettoyage automatique du tuyau d'aspiration √† l'aide de la pression d'eau (connexion d'eau requise)"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option25">
              Syst√®me de rin√ßage du tuyau avec nettoyage automatique du tuyau
              d'aspiration √† l'aide de la pression d'eau (connexion d'eau
              requise)
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option26"
              value="Syst√®me de lavage/rin√ßage de canule, via un r√©servoir fix√© lat√©ralement √† l'unit√©, avec solution d√©sinfectante"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option26">
              Syst√®me de lavage/rin√ßage de canule, via un r√©servoir fix√©
              lat√©ralement √† l'unit√©, avec solution d√©sinfectante
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option27"
              value="+37¬∞ C Syst√®me de rin√ßage auriculaire avec chauffe-eau instantan√© : affichage digital de la temp√©rature, poign√©e de rin√ßage autoclavable avec canule interchangeable et tuyau antibact√©rien avec raccord rapide incluant valve AquaStop et tuyaux de raccordement"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option27">
              +37¬∞ C Syst√®me de rin√ßage auriculaire avec chauffe-eau instantan√©
              : affichage digital de la temp√©rature, poign√©e de rin√ßage
              autoclavable avec canule interchangeable et tuyau antibact√©rien
              avec raccord rapide incluant valve AquaStop et tuyaux de
              raccordement
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option28"
              value="+37¬∞ C Syst√®me autonome de rin√ßage auriculaire : r√©servoir d'eau externe (2 litres), poign√©e de rin√ßage autoclavable avec canule interchangeable et tuyau antibact√©rien avec raccord rapide ; ind√©pendant du r√©seau d'eau domestique"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option28">
              +37¬∞ C Syst√®me autonome de rin√ßage auriculaire : r√©servoir d'eau
              externe (2 litres), poign√©e de rin√ßage autoclavable avec canule
              interchangeable et tuyau antibact√©rien avec raccord rapide ;
              ind√©pendant du r√©seau d'eau domestique
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option29"
              value="Extension vestimentaire, temp√©rature r√©glable de +22¬∞ √† +44¬∞C"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option29">
              Extension vestimentaire, temp√©rature r√©glable de +22¬∞ √† +44¬∞C
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option30"
              value="Installation pneumatique : compresseur (sans huile, 12 L/min, max. 2,5 bar), r√©servoir avec filtre √† air comprim√© autoclavable, embout de soufflerie autoclavable avec tuyau antibact√©rien √† raccord rapide incluant 3 n√©buliseurs pour m√©dicaments liquides et support pour flacons pulv√©risateurs"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option30">
              Installation pneumatique : compresseur (sans huile, 12 L/min, max.
              2,5 bar), r√©servoir avec filtre √† air comprim√© autoclavable,
              embout de soufflerie autoclavable avec tuyau antibact√©rien √†
              raccord rapide incluant 3 n√©buliseurs pour m√©dicaments liquides et
              support pour flacons pulv√©risateurs
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option31"
              value="Vanne de r√©gulation d'air pour dosage pr√©cis"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option31">
              Vanne de r√©gulation d'air pour dosage pr√©cis
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option32"
              value="1 source lumineuse √† lumi√®re froide, LED haute performance, r√©gulation int√©gr√©e, sortie lumineuse rempla√ßable avec adaptateur STORZ incluant support pour guide de lumi√®re sur le bras pivotant"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option32">
              1 source lumineuse √† lumi√®re froide, LED haute performance,
              r√©gulation int√©gr√©e, sortie lumineuse rempla√ßable avec adaptateur
              STORZ incluant support pour guide de lumi√®re sur le bras pivotant
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option33"
              value="2 sources lumineuses √† lumi√®re froide, LED haute performance, r√©gulation int√©gr√©e, sortie lumineuse rempla√ßable avec adaptateur STORZ incluant support pour guide de lumi√®re sur le bras pivotant"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option33">
              2 sources lumineuses √† lumi√®re froide, LED haute performance,
              r√©gulation int√©gr√©e, sortie lumineuse rempla√ßable avec adaptateur
              STORZ incluant support pour guide de lumi√®re sur le bras pivotant
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option34"
              value="3 sources lumineuses √† lumi√®re froide, LED haute performance, r√©gulation int√©gr√©e, sortie lumineuse rempla√ßable avec adaptateur STORZ incluant support pour guide de lumi√®re sur le bras pivotant"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option34">
              3 sources lumineuses √† lumi√®re froide, LED haute performance,
              r√©gulation int√©gr√©e, sortie lumineuse rempla√ßable avec adaptateur
              STORZ incluant support pour guide de lumi√®re sur le bras pivotant
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option35"
              value="Contr√¥le par capteur pour sources lumineuses LED, allumage automatique lors du retrait du guide de lumi√®re"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option35">
              Contr√¥le par capteur pour sources lumineuses LED, allumage
              automatique lors du retrait du guide de lumi√®re
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option36"
              value="Source lumineuse LED portative, max 1 000 lm avec connecteur WOLF"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option36">
              Source lumineuse LED portative, max 1 000 lm avec connecteur WOLF
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option37"
              value="Source lumineuse LED portative, max 1 000 lm avec connecteur STORZ"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option37">
              Source lumineuse LED portative, max 1 000 lm avec connecteur STORZ
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option38"
              value="Support pour endoscope pour sinusoscopes, non chauffant, pour le rangement des endoscopes (2,7 mm ou 4,0 mm), longueur max. 200 mm"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option38">
              Support pour endoscope pour sinusoscopes, non chauffant, pour le
              rangement des endoscopes (2,7 mm ou 4,0 mm), longueur max. 200 mm
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option39"
              value="Support pour endoscope pr√©chauff√© pour sinusoscopes, destin√© au rangement et au pr√©chauffage des endoscopes (2,7 mm ou 4,0 mm), longueur max. 200 mm"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option39">
              Support pour endoscope pr√©chauff√© pour sinusoscopes, destin√© au
              rangement et au pr√©chauffage des endoscopes (2,7 mm ou 4,0 mm),
              longueur max. 200 mm
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option40"
              value="Support pour endoscope pour laryngoscopes, non chauffant, pour le rangement des laryngoscopes (10 mm ou 11 mm), longueur max. 200 mm"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option40">
              Support pour endoscope pour laryngoscopes, non chauffant, pour le
              rangement des laryngoscopes (10 mm ou 11 mm), longueur max. 200 mm
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option41"
              value="Support pour endoscope pr√©chauff√© pour laryngoscopes, destin√© au rangement et au pr√©chauffage des laryngoscopes (10 mm ou 11 mm), longueur max. 200 mm"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option41">
              Support pour endoscope pr√©chauff√© pour laryngoscopes, destin√© au
              rangement et au pr√©chauffage des laryngoscopes (10 mm ou 11 mm),
              longueur max. 200 mm
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option42"
              value="3 porte-endoscopes pour endoscopes flexibles avec support, version 4, (profondeur 490 mm, diam√®tre int√©rieur 28 mm), support magn√©tique"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option42">
              3 porte-endoscopes pour endoscopes flexibles avec support, version
              4, (profondeur 490 mm, diam√®tre int√©rieur 28 mm), support
              magn√©tique
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option43"
              value="1 porte-endoscopes pour endoscopes flexibles avec support, version 4, (profondeur 490 mm), porte-endoscopes en acier inoxydable, diam√®tre int√©rieur 28 mm, support magn√©tique"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option43">
              1 porte-endoscopes pour endoscopes flexibles avec support, version
              4, (profondeur 490 mm), porte-endoscopes en acier inoxydable,
              diam√®tre int√©rieur 28 mm, support magn√©tique
            </div>
          </label>
          <label class="checkbox-container">
            <input
              type="checkbox"
              name="option44"
              value="Adaptateur pour porte-endoscopes en acier inoxydable, pour endoscopes flexibles XION EN-F"
            />
            <div class="checkbox"></div>
            <div class="label" data-translate="options.option44">
              Adaptateur pour porte-endoscopes en acier inoxydable, pour
              endoscopes flexibles XION EN-F
            </div>
          </label>
        </div>
        <button type="button" class="button" id="validateOptions">
          Valider mes options
        </button>
      </div>
    </div>

    <!-- ======================================
         Popup Modal Coordonn√©es (initialement masqu√©)
    ====================================== -->
    <div class="modal" id="coordinatesModal">
      <div class="modal-content">
        <button class="modal-close" id="closeCoordinates">&times;</button>
        <h2>Entrez vos coordonn√©es</h2>
        <!-- (Optionnel : un spinner de chargement peut √™tre affich√© ici) -->
        <div class="loading-spinner hide"></div>
        <form id="userInfoForm" data-js-submit="true">
          <div class="form-group">
            <label for="name">Nom</label>
            <input type="text" id="name" name="name" required />
          </div>
          <div class="form-group">
            <label for="firstname">Pr√©nom</label>
            <input type="text" id="firstname" name="firstname" required />
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" required />
          </div>
          <!-- Ici le bouton permet d'ouvrir le popup r√©capitulatif -->
          <button type="submit" class="button">Valider mes coordonn√©es</button>
        </form>
      </div>
    </div>

    <!-- ======================================
         Popup Modal R√©capitulatif
    ====================================== -->
    <div class="modal" id="summaryModal">
      <div class="modal-content">
        <button class="modal-close" id="closeSummary">&times;</button>
        <h2>R√©capitulatif de votre commande</h2>
        <div id="summaryContent">
          <!-- Le contenu sera rempli dynamiquement -->
          <p id="summaryColor">
            <!-- Le span "color-sample" affichera la couleur -->
            <span class="color-sample" id="colorSample"></span>
            <span id="colorName"></span>
          </p>
          <p id="summaryOptions"></p>
        </div>
        <button type="button" class="button" id="confirmOrder">
          Confirmer
        </button>
      </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
      <div class="footer-logo">
        <img
          class="footer-logo-img"
          src="assets/logos/kbmed.svg"
          alt="KB MED"
        />
        <p class="footer-logo-text" data-translate="general.copyright"></p>
      </div>
      <p class="follow-text" data-translate="general.follow"></p>
      <div class="social-links">
        <a href="#"><img src="assets/icons/instagram.svg" alt="Instagram" /></a>
        <a href="#"><img src="assets/icons/facebook.svg" alt="Facebook" /></a>
        <a href="#"><img src="assets/icons/linkedin.svg" alt="LinkedIn" /></a>
      </div>
    </footer>
    <script src="js/main.js"></script>
    <script src="js/components/colorSelectorL.js"></script>
    <script src="js/components/dropdown.js"></script>
    <script src="js/components/navigation.js"></script>

    <!-- ======================================
         Script de validation et envoi d'email
    ====================================== -->
    <script>
      
      document.addEventListener("DOMContentLoaded", function () {
        initFormValidation();
      });

      function initFormValidation() {
        const forms = document.querySelectorAll("form");

        forms.forEach((form) => {
          form.addEventListener("submit", function (e) {
            if (form.getAttribute("data-js-submit") === "true") {
              e.preventDefault();
            }
            if (!validateForm(form)) {
              e.preventDefault();
            } else {
              console.log("Formulaire valid√© !");
              // Pour le formulaire des coordonn√©es, on passe au popup r√©capitulatif
              if (form.id === "userInfoForm") {
                closeCoordinatesModal();
                openSummaryModal();
              } else {
                sendConfigurationEmail();
              }
            }
          });

          const inputs = form.querySelectorAll("input, select, textarea");
          inputs.forEach((input) => {
            input.addEventListener("blur", function () {
              validateInput(this);
            });
            input.addEventListener("input", function () {
              if (this.classList.contains("invalid")) {
                this.classList.remove("invalid");
                const errorMessage = this.nextElementSibling;
                if (
                  errorMessage &&
                  errorMessage.classList.contains("error-message")
                ) {
                  errorMessage.remove();
                }
              }
            });
          });
        });
      }

      function validateForm(form) {
        let isValid = true;
        const inputs = form.querySelectorAll("input, select, textarea");
        inputs.forEach((input) => {
          if (!validateInput(input)) {
            isValid = false;
          }
        });
        return isValid;
      }

      function validateInput(input) {
        if (input.disabled || input.readOnly) {
          return true;
        }
        let isValid = true;
        let errorMessage = "";
        const existingError = input.nextElementSibling;
        if (
          existingError &&
          existingError.classList.contains("error-message")
        ) {
          existingError.remove();
        }
        if (input.hasAttribute("required") && !input.value.trim()) {
          isValid = false;
          errorMessage = "Ce champ est requis";
        } else if (
          input.type === "email" &&
          input.value.trim() &&
          !validateEmail(input.value)
        ) {
          isValid = false;
          errorMessage = "Veuillez entrer une adresse email valide";
        } else if (input.hasAttribute("pattern") && input.value.trim()) {
          const pattern = new RegExp(input.getAttribute("pattern"));
          if (!pattern.test(input.value)) {
            isValid = false;
            errorMessage = input.title || "Format invalide";
          }
        } else if (
          input.hasAttribute("minlength") &&
          input.value.length < parseInt(input.getAttribute("minlength"))
        ) {
          isValid = false;
          errorMessage = `Minimum ${input.getAttribute(
            "minlength"
          )} caract√®res requis`;
        }
        if (!isValid) {
          input.classList.add("invalid");
          const errorElement = document.createElement("div");
          errorElement.classList.add("error-message");
          errorElement.textContent = errorMessage;
          input.insertAdjacentElement("afterend", errorElement);
        } else {
          input.classList.remove("invalid");
        }
        return isValid;
      }

      function validateEmail(email) {
        const re = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        return re.test(String(email).toLowerCase());
      }

      // ========================================================
      // Envoi de l'email via EmailJS
      // ========================================================
      const EMAIL_SERVICE_ID = "service_pff2cmo";
      const EMAIL_TEMPLATE_ID = "template_50exznp";

      function sendConfigurationEmail() {
        const loadingSpinner = document.querySelector(".loading-spinner");
        if (loadingSpinner) loadingSpinner.classList.remove("hide");

        const name = document.getElementById("name").value.trim();
        const firstname = document.getElementById("firstname").value.trim();
        const email = document.getElementById("email").value.trim();

        if (!email) {
          alert("Veuillez entrer une adresse email.");
          if (loadingSpinner) loadingSpinner.classList.add("hide");
          return;
        }

        // R√©cup√©ration de la couleur depuis un √©l√©ment ou sessionStorage
        let selectedColor = "";
        const selectedColorElement = document.getElementById("selectedColor");
        if (selectedColorElement) {
          selectedColor = selectedColorElement.textContent.trim();
        } else {
          selectedColor = sessionStorage.getItem("selectedColor") || "";
        }

        // R√©cup√©ration des options depuis le sessionStorage
        const storedOptions = sessionStorage.getItem("selectedOptions");
        const selectedOptions = storedOptions
          ? JSON.parse(storedOptions).join(", ")
          : "";

        const selectedLanguage = window.currentLanguage || "fr";

        const emailContent = prepareEmailContent(
          selectedLanguage,
          firstname,
          selectedColor,
          selectedOptions
        );

        const templateParams = {
          to_name: `${firstname} ${name}`,
          to_email: email,
          message: emailContent,
        };

        emailjs
          .send(EMAIL_SERVICE_ID, EMAIL_TEMPLATE_ID, templateParams)
          .then(
            function (response) {
              console.log("SUCCESS!", response.status, response.text);
              completeEmailSending(true);
            },
            function (error) {
              console.log("FAILED...", error);
              completeEmailSending(false);
            }
          );
      }

      function prepareEmailContent(
        language,
        firstname,
        selectedColor,
        selectedOptions
      ) {
        const messages = {
          fr: {
            subject: "üéâ Votre configuration a √©t√© enregistr√©e !",
            greeting: `Bonjour ${firstname},\n`,
            confirmation:
              "Nous confirmons que votre configuration pour le MODULA L a √©t√© enregistr√©e.\n",
            contact: "Nous vous contacterons d√®s que possible.\n",
            thankYou: "Merci pour votre int√©r√™t.\n",
            seeYouSoon: "√Ä bient√¥t !\n",
            recap: "R√©capitulatif de votre commande :\n",
            colorChosen: `Couleur choisie : ${selectedColor}\n`,
            optionsChosen: `Options choisies : ${selectedOptions}\n`,
            companyInfo:
              "KBMedizintechnik\nGewerbestrasse 6, 4105 Biel-Benken\nB√ºro : +41 61 331 68 51\nMobile : +41 78 683 68 28\nFax : +41 61 331 68 52\ninfo@kbmed.ch",
          },
          de: {
            subject: "üéâ Ihre Konfiguration wurde gespeichert!",
            greeting: `Guten Tag ${firstname},\n`,
            confirmation:
              "Wir best√§tigen, dass Ihre Konfiguration f√ºr MODULA L gespeichert wurde.\n",
            contact: "Wir werden Sie so schnell wie m√∂glich kontaktieren.\n",
            thankYou: "Danke f√ºr Ihr Interesse.\n",
            seeYouSoon: "Bis bald!\n",
            recap: "Zusammenfassung Ihrer Bestellung:\n",
            colorChosen: `Gew√§hlte Farbe: ${selectedColor}\n`,
            optionsChosen: `Gew√§hlte Optionen: ${selectedOptions}\n`,
            companyInfo:
              "KBMedizintechnik\nGewerbestrasse 6, 4105 Biel-Benken\nB√ºro : +41 61 331 68 51\nMobile : +41 78 683 68 28\nFax : +41 61 331 68 52\ninfo@kbmed.ch",
          },
          it: {
            subject: "üéâ La tua configurazione √® stata salvata!",
            greeting: `Buongiorno ${firstname},\n`,
            confirmation:
              "Confermiamo che la configurazione del MODULA L √® stata salvata.\n",
            contact: "Ti contatteremo il prima possibile.\n",
            thankYou: "Grazie per il tuo interesse.\n",
            seeYouSoon: "A presto!\n",
            recap: "Riepilogo del tuo ordine:\n",
            colorChosen: `Colore scelto: ${selectedColor}\n`,
            optionsChosen: `Opzioni scelte: ${selectedOptions}\n`,
            companyInfo:
              "KBMedizintechnik\nGewerbestrasse 6, 4105 Biel-Benken\nB√ºro : +41 61 331 68 51\nMobile : +41 78 683 68 28\nFax : +41 61 331 68 52\ninfo@kbmed.ch",
          },
        };

        const msg = messages[language];
        return `
${msg.subject}\n
${msg.greeting}
${msg.confirmation}
${msg.contact}
${msg.thankYou}
${msg.seeYouSoon}
${msg.recap}
${msg.colorChosen}
${msg.optionsChosen}
${msg.companyInfo}
        `;
      }

      function completeEmailSending(success) {
        const loadingSpinner = document.querySelector(".loading-spinner");
        if (loadingSpinner) {
          loadingSpinner.classList.add("hide");
        }
        if (success) {
          alert(
            "Votre configuration a √©t√© enregistr√©e et un email r√©capitulatif vous a √©t√© envoy√©."
          );
          closeSummaryModal();
        } else {
          alert(
            "Une erreur est survenue lors de l'envoi de l'email. Veuillez r√©essayer."
          );
        }
      }

      function closeCoordinatesModal() {
        const coordinatesModal = document.getElementById("coordinatesModal");
        coordinatesModal.classList.remove("active");
      }

      function openSummaryModal() {
        // R√©cup√©ration de la couleur depuis un √©l√©ment ou sessionStorage
        let selectedColor = "";
        // Ici, vous pouvez adapter la m√©thode de r√©cup√©ration de couleur
        const selectedColorElement = document.getElementById("selectedColor");
        if (selectedColorElement) {
          selectedColor = selectedColorElement.textContent.trim();
        } else {
          selectedColor = sessionStorage.getItem("selectedColor") || "ral-9016";
        }
        // Mettre √† jour le nom de la couleur dans le r√©capitulatif
        document.getElementById("colorName").textContent = selectedColor;
        // Exemple simple : associer la classe de couleur √† la sample
        // Ici, nous supposons que la couleur r√©cup√©r√©e correspond √† une classe CSS d√©finie comme .color-ralXXXX
        // Vous pouvez adapter en fonction de votre logique de s√©lection couleur
        document
          .getElementById("colorSample")
          .className = "color-sample " + (selectedColor || "").toLowerCase().replace(/\s/g, "");

        // R√©cup√©ration des options depuis le sessionStorage
        const storedOptions = sessionStorage.getItem("selectedOptions");
        let selectedOptions = storedOptions
          ? JSON.parse(storedOptions).join(", ")
          : "Aucune option s√©lectionn√©e";

        document.getElementById("summaryOptions").textContent =
          "Options choisies : " + selectedOptions;

        const summaryModal = document.getElementById("summaryModal");
        summaryModal.classList.add("active");
      }

      function closeSummaryModal() {
        const summaryModal = document.getElementById("summaryModal");
        summaryModal.classList.remove("active");
      }
    </script>

    <!-- ======================================
         Script de gestion des modals et de la langue
    ====================================== -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Gestion des popups
        const openOptionsBtn = document.getElementById("openOptionsBtn");
        const optionsModal = document.getElementById("optionsModal");
        const validateOptionsBtn = document.getElementById("validateOptions");
        const closeOptionsBtn = document.getElementById("closeOptions");

        const coordinatesModal = document.getElementById("coordinatesModal");
        const closeCoordinatesBtn = document.getElementById("closeCoordinates");

        const summaryModal = document.getElementById("summaryModal");
        const closeSummaryBtn = document.getElementById("closeSummary");
        const confirmOrderBtn = document.getElementById("confirmOrder");

        openOptionsBtn.addEventListener("click", function () {
          optionsModal.classList.add("active");
        });

        validateOptionsBtn.addEventListener("click", function () {
          const checkedOptions = document.querySelectorAll(
            ".checkbox-container input[type='checkbox']:checked"
          );
          const selectedOptions = Array.from(checkedOptions).map((checkbox) =>
            checkbox
              .closest(".checkbox-container")
              .querySelector(".label").textContent
          );
          sessionStorage.setItem("selectedOptions", JSON.stringify(selectedOptions));
          console.log("Options s√©lectionn√©es :", selectedOptions);
          optionsModal.classList.remove("active");
          coordinatesModal.classList.add("active");
        });

        if (closeOptionsBtn) {
          closeOptionsBtn.addEventListener("click", function () {
            optionsModal.classList.remove("active");
          });
        }

        if (closeCoordinatesBtn) {
          closeCoordinatesBtn.addEventListener("click", function () {
            coordinatesModal.classList.remove("active");
          });
        }

        if (closeSummaryBtn) {
          closeSummaryBtn.addEventListener("click", function () {
            summaryModal.classList.remove("active");
          });
        }

        // Envoi du mail lors du clic sur "Confirmer" dans le popup r√©capitulatif
        confirmOrderBtn.addEventListener("click", function () {
          sendConfigurationEmail();
        });

        // Gestion du changement de langue
        const languageSelectors = document.querySelectorAll(".language-selector");
        languageSelectors.forEach((selector) => {
          selector.addEventListener("click", function () {
            languageSelectors.forEach((el) =>
              el.classList.remove("active")
            );
            this.classList.add("active");
            // Ici, vous pouvez d√©finir la langue s√©lectionn√©e (ex: window.currentLanguage)
            window.currentLanguage = this.querySelector("img").getAttribute("data-lang");
            console.log("Langue s√©lectionn√©e :", window.currentLanguage);
          });
        });
      });
    </script>
  </body>
</html>
